<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name=App-Config content="fullscreen=yes,useHistoryState=yes,transition=yes">
    <meta content=yes name=apple-mobile-web-app-capable>
    <meta name=‚Äùapple-touch-fullscreen‚Äù content=‚Äùyes‚Äù>
    <meta name="theme-color" content="#1a1a1a">
    <meta content="telephone=no,email=no" name=format-detection>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name=viewport
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=yes,viewport-fit=cover">
    <title></title>
    <link rel="stylesheet" href="css/content.css">
    <style>
        .B1_text p {
            padding: 10px 0;
        }

        .B1_text .header {
            font-size: 18px;
            text-align: right;
        }

        #bodyBox {
            font-size: 26px;
        }

        #readOpt .header,
        #readOpt .footer {
            font-size: 18px;
        }

        #menu .curr-pos {
            font-weight: inherit;
            color: inherit;
        }

        .curr {
            font-weight: bolder;
            color: #993300;
        }
    </style>
</head>

<body>
    <div id="app" v-cloak :class="'bg'+theme" class="theme">
        <!-- ÁøªÈ°µ -->
        <!-- <template v-if="isPage">
            <div class="page-box up" @click="pageUp"></div>
            <div class="page-box down" @click="pageDown(1)"></div>
        </template> -->

        <!-- ÁõÆÂΩï -->
        <div id="menu" v-swipeleft="clickHideMenu" class="list-group" :class="{'show-a': showMenu}"
            @dblclick.stop="clickHideMenu">
            <div>
                <div class="search-box" v-if="len>15">
                    <input type="search" class="form-control search" @input="search" @keyup.enter="enterSearch"
                        v-model="word" placeholder="ÊêúÁ¥¢...">
                </div>
                <div :class="{'curr-pos': len>15}">
                    <div class="fx">
                        <span class="list-group-item fz book" :class="{active: item.id==theme}"
                            v-for="(item, index) in themeL" @click.stop="changeTheme(item)"
                            :key="item.id">{{item.n}}</span>
                        <span class="list-group-item fz book" @click.stop="switchDark">
                            <i class="zhe"></i>
                            <input class="switch" type="checkbox" v-model='isDark'>Á≥ªÁªü</span>
                    </div>
                    <div class="fx">
                        <span @click.stop="switchPage" class="list-group-item fz book"><i class="zhe"></i><input
                                class="switch" type="checkbox" v-model='isPage'>ÁøªÈ°µ</span>
                        <span @click.stop="switchOrder" class="list-group-item fz book"><i class="zhe"></i><input
                                class="switch" type="checkbox" v-model='isReverse'>ÂÄíÂ∫è</span>
                        <span class="list-group-item fz book" v-if="len>5">ÂÖ±:{{len}}Á´†</span>
                        <span class="list-group-item fz book" @click="getAllTotal">ÊÄª: {{total('',allTotal)}}</span>
                    </div>
                    <div class="list-group-item fz book curr" @click="toTop">
                        <!-- {{subProcess}}- -->
                        ‰ΩçÁΩÆÔºö{{currIdx+1}}-{{articleD.title}}({{articleD.total}})
                    </div>
                </div>

                <!-- ÁõÆÂΩïÂàóË°® -->
                <div class="menu-item" v-for="(item, idx) in menuList" :key="item.id" v-show="!item.hide"
                    :id="'m'+item.id">
                    <a class="list-group-item " href="javascript:" @click="toArticle(item.idx);"
                        :class="['list-group-item-'+colors[idx%4],{active: item.idx===currIdx}]">
                        {{item.idx+1}}--{{item.title}}
                        <span v-if="item.articleD">({{item.articleD.total}})</span>
                    </a>
                </div>
                <!-- Â≠ó‰ΩìÂ§ßÂ∞èËÆæÁΩÆ -->
                <div>
                    <span class="list-group-item fz" :key="item" :class="{'active': item == currFontS}"
                        v-for="item in font" @click="setFontS(item)">{{item}}
                    </span>

                </div>
                <div>
                    <span class="list-group-item fz">ÂΩìÂâçÂ≠óÂè∑Ôºö{{ currFontS }}</span>
                    <span class="list-group-item  fz" @click="setFontS('+')">+</span>
                    <span class="list-group-item fz" @click="setFontS('-')">-</span>
                </div>
                <!-- Â≠ó‰ΩìËÆæÁΩÆ -->
                <div>
                    <span class="list-group-item fz" :key="item" :class="{'active': item.v == currFontF}"
                        v-for="(item) in fontF" @click="setFontF(item)">{{item.n}}
                    </span>
                </div>

            </div>
        </div>

        <!-- ÂÜÖÂÆπ -->
        <div id="bodyBox" v-show="articleD.html">
            <div class="panel-footer page-tap prev" @click.stop="pageNext('-')" v-if="currIdx-1>=0">
                ‰∏ä‰∏ÄÁ´† - {{subTit(menuList[currIdx-1]['title'])}}
                <span @click.stop="pageNext('+')" v-if="currIdx+1<len">‰∏ã‰∏ÄÁ´†</span>
            </div>
            <div class="body-box" @dblclick.capture="clickShowMenu()">
                <div :class="['panel','panel-'+colors[currIdx%4]]" @click.stop="showReadOpt()">
                    <div class="panel-heading">
                        <h3 class="panel-title text-center">
                            {{articleD.title}}
                            <!-- <span class="author">‰ΩúËÄÖÔºö</span> -->
                            <!-- <span class="author">({{item.total}})</span> -->
                        </h3>
                    </div>
                    <div class="panel-footer">
                        ÂèëÂ∏ÉÊó∂Èó¥Ôºö{{articleD.date}}</div>
                    <div class="panel-body" v-html="articleD.html"></div>
                </div>
            </div>
            <div class="panel-footer page-tap next" v-if="currIdx+1<len" @click.stop="pageNext('+')">
                ‰∏ã‰∏ÄÁ´† - {{subTit(menuList[currIdx+1]["title"])}}
            </div>
        </div>

        <!-- ËÆæÁΩÆ -->
        <div id="readOpt" @click.capture="hideReadOpt" @touchend="getP" :class="{active: showOpt}">
            <div class="header" v-if="currItem">
                <span class="h-l" @click="switchTheme">
                    <template v-if="theme == 4">üîÜ</template><template v-else>üåô</template>
                </span>
                {{subTit(currItem.title)}}
                <span class="h-r" @click="clickShowMenu()">ÁõÆÂΩï</span>
            </div>
            <div class="footer">
                <div class="f-item">
                    <span>Â≠óÔºö{{articleD.total}} -- ËøõÔºö{{process}} -- {{read_time}}</span>
                </div>
                <!-- <span class="f-page">{{pageCurr}}/{{pageAll}}</span> -->
            </div>
        </div>
    </div>
</body>
<script src="js/comm.js"></script>
<script src="js/touch.js"></script>
<script src="js/jq.js"></script>
<script>
    var that;
    var id = $echo.getParams('id');
    var key = $echo.getParams('key');
    new Vue({
        el: '#app',
        data: {
            title: 'ËôöÁ©∫Êµé',
            apiUrl: 'https://api2022.xukongji.com',
            articleD: {}, // ÊâÄÊúâÊï∞ÊçÆÂàóË°®
            menuList: [], // ËèúÂçïÂàóË°®
            len: 0,
            colors: ['success', 'info', 'warning', 'danger'],
            showMenu: false, // ÂàáÊç¢ÊòæÁ§∫ËèúÂçï
            font: [20, 22, 24, 26, 28, 30],
            fontF: [
                { n: 'ÈªòËÆ§', v: 'inherit' },
                { n: 'Ê•∑‰Ωì1', v: 'kt1' },
                { n: 'Ê•∑‰Ωì2', v: 'kt2' },
                { n: 'Áõõ‰∏ñ', v: 'ss' },
                { n: '‰ªäÊ•∑', v: 'jk' },
                { n: '‰∫ëÈªë', v: 'yh' },
                { n: 'Ë°åÈªë', v: 'xh' },
                { n: 'Âç°ÈÄö', v: 'kt' }
            ],
            currFontS: 26,
            currFontF: 'inherit',
            footMenu: [{
                n: 'ËÆæÁΩÆ'
            }],
            themeL: [{ // ‰∏ªÈ¢ò
                n: 'ÈòÖËØª',
                id: 1
            }, {
                n: 'Âè§È£é',
                id: 2
            }, {
                n: 'ÁôΩÂ§©',
                id: 3
            }, {
                n: 'Â§úÊôö',
                id: 4
            }],
            theme: 1, // 1ÈªòËÆ§Ôºå1Ôºåbg1,bg2
            process: 0, // ÂΩìÂâçÈòÖËØªËøõÂ∫¶
            allTotal: 0,// ÊÄªÂ≠óÊï∞
            word: '', // ÊêúÁ¥¢ÁõÆÂΩïÂÖ≥ÈîÆÂ≠ó
            height: 0,// Â±èÂπïÁöÑÈ´òÂ∫¶
            isDark: false, // ÈªòËÆ§Á≥ªÁªü‰∏ªÈ¢ò
            isReverse: false, // ÈªòËÆ§ÁõÆÂΩïÊéíÂ∫è
            isPage: false, // ÊòØÂê¶ÂºÄÂêØÁøªÈ°µ
            currItem: '', // ÂΩìÂâçÊ†áÈ¢òÂêçÁß∞
            currIdx: '', // ÂΩìÂâçÁ¥¢Âºï
            showOpt: false, // ÊòØÂê¶ÊòæÁ§∫ËÆæÁΩÆ
            dbTime: null, // ÂèåÂáªÂçïÊú∫Êó∂Èó¥ËÆ°Êó∂Âô®
            processTime: null, // Ëé∑ÂèñÁôæÂàÜÊØîËÆ°Êó∂Âô®
            xkj_text: {}, // Êú¨Âú∞id
            read_time: '0', // ÈòÖËØªÊó∂Èó¥
            readtimer: null,        // ÈòÖËØªÊó∂Èó¥ÂÆöÊó∂Âô®

        },
        methods: {
            // Ëé∑ÂèñhtmlËØ∑Ê±ÇÂáΩÊï∞
            getHtml: function (url) {
                return new Promise((r, s) => {
                    $.ajax({
                        type: "GET",
                        url: url,
                        async: false,
                        cache: false,
                        contentType: "application/x-www-form-urlencoded",
                        dataType: "html",
                        success: function (res) {
                            r(res)
                        },
                        error: function (res) {
                            if (res.status === 404) {
                                alert('ÂΩìÂâçÁΩëÈ°µÁª¥Êä§‰∏≠...ÔºåËØ∑ÁÇπÂáªÁ°ÆÂÆöÂÖ≥Èó≠')
                                window.close();
                            } else {
                                alert('ÂΩìÂâçÁΩëÈ°µÂá∫ÈîôÔºÅÔºÅÔºÅ')
                                window.close();
                            }

                        }
                    });
                })

            },

            // Ë∑≥ËΩ¨Âà∞È°∂ÈÉ®
            toTop: function () {
                // window.scrollTo(0, 0);
                var mid = document.getElementById('m' + this.currItem.id);
                var menu = document.getElementById('menu');
                menu.scrollTop = mid.offsetTop - 240
            },

            // Ë£ÅÂâ™Ê†áÈ¢ò
            subTit: function (title) {
                return title.slice(0, 20)
            },

            // ËÆ°ÁÆóÊÄªÊï∞
            total: function (str, n) {
                if (n) {
                    if (n >= 1000 && n < 10000) {
                        n = n / 1000 + 'k'
                    } else if (n >= 10000) {
                        n = n / 10000 + 'w'
                    }
                    return n;
                }
                var num = 0
                for (i = 0; i < str.length; i++) {
                    s = str.charAt(i)
                    if ('\u4e00' <= s && s <= '\u9fef') {
                        num += 1;
                    }
                }
                if (num >= 1000 && num < 10000) {
                    s = num / 1000 + 'k'
                } else if (num >= 10000) {
                    s = num / 10000 + 'w'
                } else {
                    s = num
                }
                return { s: s, n: num };
            },

            getAllTotal: function () {
                this.menuList.forEach((item, idx) => {
                    if (!item.articleD) {
                        setTimeout(() => {
                            this.getArticle(item, true);
                        }, idx * 30)
                    }
                })

            },

            // ËÆæÁΩÆÂ≠ó‰ΩìÂ§ßÂ∞è
            setFontS: function (size) {
                if (size == '+') {
                    s = (s + 1)
                } else if (size == '-') {
                    s = (s - 1)
                } else {
                    s = size;
                }
                var dom = document.querySelector('#bodyBox');
                dom.style.fontSize = s + 'px';

                // Áî±‰∫éÂ≠ó‰ΩìÊîπÂèòÂêéÈ°µÈù¢È´òÂ∫¶ÂèòÂåñÔºåÈúÄË¶ÅÂª∂ËøüÈáçÊñ∞ËÆ°ÁÆóÂõûÂà∞ÂΩìÂâç‰ΩçÁΩÆ
                this.currFontS = s;
                $echo.setStorage('fontSize', this.currFontS);
            },

            // ÊòæÁ§∫ËèúÂçïÂàáÊç¢
            clickShowMenu: function () {
                this.showMenu = true;
                setTimeout(this.hideReadOpt, 200)
            },

            // ÂêëÂ∑¶ÊªëÂä®ÈöêËóèËèúÂçï
            clickHideMenu: function () {
                this.showMenu = false
            },

            // Ê∏ÖÁ©∫ËÆæÁΩÆ
            reset: function (s) {
                var is = window.confirm('ÊòØÂê¶Ê∏ÖÁ©∫Ôºü')
                if (is) {
                    if (s === 's') {
                        localStorage.removeItem('localInfo_' + type)
                        sessionStorage.clear();
                    } else if (s === 'c') {
                        INDEXDB.deleteItem(type);
                    }
                }
            },

            // ÊêúÁ¥¢ÁõÆÂΩï
            search: function () {
                this.menuList.forEach((item, id) => {
                    if ((id + 1 + '--' + item.title).indexOf(this.word) > -1) {
                        item.hide = false;
                    } else {
                        item.hide = true;
                    }
                })
            },
            // ÂõûËΩ¶
            enterSearch: function () {

            },

            // ÂàáÊç¢ÊéíÂ∫èÂÄíÂ∫è
            switchOrder: function () {
                this.isReverse = !this.isReverse
                this.menuList.reverse();
            },

            // ËÆæÁΩÆ‰∏ªÈ¢ò
            changeTheme: function (item) {
                this.theme = item.id
                $echo.setStorage('theme', this.theme);
            },

            // ËÆæÁΩÆÂ≠ó‰Ωì
            setFontF: function (item) {
                if (item) {
                    this.currFontF = item.v;
                    $echo.setStorage('font', this.currFontF);
                }
                setTimeout(() => {
                    document.body.style.fontFamily = this.currFontF
                }, 16)
            },

            // ÂºÄÂêØË∑üÈöèÁ≥ªÁªü‰∏ªÈ¢ò
            switchDark: function () {
                this.isDark = !this.isDark;
                if (this.isDark && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    this.theme = 4;
                } else {
                    this.theme = localStorage.theme;
                }
                localStorage.setItem('isDark', this.isDark)
            },

            // ÂàáÊç¢ÁôΩÂ§©ÂíåÈªëÂ§ú
            switchTheme: function () {
                if (this.theme === 4) {
                    this.theme = 1;
                } else {
                    this.theme = 4;
                }
            },

            // ÂºÄÂêØÁøªÈ°µ
            switchPage: function () {
                this.isPage = !this.isPage;
            },

            // ÊòæÁ§∫ÈòÖËØªËÆæÁΩÆ
            showReadOpt: function (id, item) {
                if (window.getSelection().toString() !== '') return false;
                clearTimeout(this.dbTime);
                // ÂèåÂáªËèúÂçïÂíåÂçïÊú∫ËèúÂçïÂÆöÊó∂Âô®ÂÜ≤Á™Å
                if (this.showOpt) {
                    this.showOpt = false;
                } else {
                    this.dbTime = setTimeout(() => {
                        this.showOpt = true;
                        this.getProcess(); // ËÆ°ÁÆóËøõÂ∫¶Êù°
                        this.savePos(); // ‰øùÂ≠ò‰∏ÄÊ¨°‰ΩçÁΩÆ
                        clearTimeout(this.dbTime); 
                        // ÂÆöÊó∂ËÆ°ÁÆóËøõÂ∫¶Êù°
                        this.dbTime = setInterval(()=> {
                            this.getProcess();
                        }, 5000)
                    }, 220)
                }

            },

            // ÈöêËóèÈòÖËØªËÆæÁΩÆ
            hideReadOpt: function () {
                clearTimeout(this.dbTime);
                this.showOpt = false;
            },

            // Ë∑≥ËΩ¨ÊñáÁ´†
            toArticle: function (idx) {
                window.scrollTo(0, 0); // Ë∑≥ËΩ¨Âà∞ÊñáÁ´†È°∂ÈÉ®
                if (this.currIdx === idx) return false;
                this.menuList.some((item)=>{
                    if(item.idx === idx) this.currItem = item;
                })
                this.currIdx = idx;
                this.saveText();  // ‰øùÂ≠òÊú¨Âú∞
                if (this.currItem.articleD) {
                    this.articleD = this.currItem.articleD;
                    document.title = this.articleD.title;
                } else {
                    this.getArticle(this.currItem);
                }
            },
            // ‰∏ã‰∏ÄÁ´† // ‰∏ä‰∏ÄÁ´†
            pageNext: function (type) {
                if (type === '+') {
                    this.toArticle(this.currIdx + 1)
                } else if (type === '-') {
                    this.toArticle(this.currIdx - 1)
                }
            },

            // Ëé∑Âèñhtml
            getArticle: function (currItem, isAll) {
                new Promise((r, s) => {
                    var re3 = /[\r\n\f\t]|(<\/?br\/?>)+|\sstyle=".*?"|(&nbsp;)|<strong>[\s\t\r\f\n]*<\/strong>|<span>[\s\t\r\f\n]*<\/span>|<p>[\s\t\r\f\n]*<\/p>|<div>[\s\t\r\f\n]*<\/div>/img
                    if (key === 'brws') {
                        var path = 'https://www.shishengru.com' + currItem.id;
                        this.getHtml(path).then(res => {
                            var reimg = /<img.*?>/img
                            res = res.replace(reimg, '')
                            $doc = $(res);
                            var html = $doc.find('.article-content').html();
                            var date = $doc.find('.f-reveal-time strong').eq(2).text();
                            while (html.match(re3)) {
                                html = html.replace(re3, "");
                            }
                            r({ html: html, date: date })
                        })
                    } else if (key === 'xkj') {
                        var path = this.apiUrl + '/api/article/menuInfoWeb?id=' + currItem.id;
                        this.getHtml(path).then(res => {
                            while (res.match(re3)) {
                                res = res.replace(re3, "");
                            }
                            var re_all = /<article class=\"article\">.*<\/article>/mgi;  // ÊñáÁ´†ÈÉ®ÂàÜ
                            var re_article = /<div class=\"content\">.*<\/div>/img  // Ê≠£ÊñáÈÉ®ÂàÜ
                            var re_date = /\d+-\d+-\d+(\s+\d+:\d+)?/img
                            var html = res.match(re_all)[0]
                            var date = html.match(re_date)[0]
                            html = html.match(re_article)[0] // Ê≠£Êñá
                            r({ html: html, date: date })
                        })
                    }
                }).then((res) => {
                    html = res.html;
                    date = res.date;
                    html = '<div class="B1_text">' + html + '</div>'
                    var total = this.total(html);
                    this.allTotal += total.n; // ËÆ°ÁÆóÊÄªÂ≠óÊï∞
                    // ËÆæÁΩÆÂ≠óÊï∞Âà∞ÁõÆÂΩï‰∏ä
                    var title = currItem.title;
                    var articleD = { 'title': title, 'html': html, 'date': date, 'total': total.s }
                    if (!isAll) {
                        this.articleD = articleD;
                        document.title = title;
                    }
                    this.$set(currItem, 'articleD', articleD); // ÊääÈ°µÈù¢Êï∞ÊçÆËµãÁªôËèúÂçï‰∏ä
                    this.setReadTime(); // ÂºÄÂêØÈòÖËØªÊó∂Èó¥
                })
            },

            // Ëé∑ÂèñÈòÖËØªÊó∂Èó¥
            setReadTime: function () {
                clearInterval(this.readtimer);
                var n = 0;
                this.readtimer = setInterval(() => {
                    ++n;
                    this.read_time = this.getTimes(n)
                }, 1000)
            },

            getTimes: function (t) {
                var h = parseInt(t / 60 / 60 % 24)
                var m = parseInt(t / 60 % 60)
                var s = parseInt(t % 60)
                //‰∏âÂÖÉË°®ËææÂºè Ë°•Èõ∂ Â¶ÇÊûúÂ∞è‰∫é10 ÂàôÂú®ÂâçËæπËøõË°åË°•Èõ∂ Â¶ÇÊûúÂ§ß‰∫é10 Âàô‰∏çÈúÄË¶ÅË°•Èõ∂
                // h = h < 10 ? '0' + h : h
                // m = m < 10 ? '0' + m : m
                // s = s < 10 ? '0' + s : s
                h = h ? h + 'Êó∂:' : '';
                m = m ? m + 'ÂàÜ:' : '';
                s = s + 'Áßí';
                return h + m + s
            },

            // ‰øùÂ≠òÊú¨Âú∞ËßÜÈ¢ë‰ΩçÁΩÆ
            saveText: function () {
                var xkj_text = localStorage.getItem('xkj_text');
                if (xkj_text) this.xkj_text = JSON.parse(xkj_text);
                this.xkj_text['t' + id] = this.currItem.id;
                localStorage.setItem('xkj_text', JSON.stringify(this.xkj_text))
            },

            // ËÆ°ÁÆóÂΩìÂâç‰ΩçÁΩÆÁöÑÁôæÂàÜÊØîÊï∞Â≠ó
            getProNum: function () {
                var elH = document.documentElement.scrollHeight || document.body.scrollHeight; // ÂΩìÂâçÁ´†ËäÇÈ´òÂ∫¶
                var scrollTop = document.documentElement.scrollTop; // ÊªöÂä®È´òÂ∫¶
                var p = (scrollTop) / (elH - this.height);
                p = p.toFixed(6);
                p = parseFloat(p);
                return p;
            },

            // Ë∑≥ËΩ¨
            toPos: function (p) {
                p = parseFloat(p);
                this.$nextTick(() => {
                    var elH = document.documentElement.scrollHeight || document.body.scrollHeight; // ÂΩìÂâçÁ´†ËäÇÈ´òÂ∫¶
                    var scrollTop = p * (elH - this.height);
                    window.scrollTo(0, scrollTop);
                })
            },

            // ËÆ°ÁÆóÈòÖËØªÁôæÂàÜÊØî
            getProcess: function () {
                p = this.getProNum();
                p = p >= 1 ? 1 : p;
                p = (p * 100).toFixed(2)
                if (p == 0) {
                    p = 0;
                } else if (p >= 100) {
                    p = 100;
                }
                this.process = p + '%';

            },

            savePos: function () {
                this.xkj_text['tn' + id] = this.getProNum();
                localStorage.setItem('xkj_text', JSON.stringify(this.xkj_text))
            },

            getP: function () {
                clearInterval(this.processTime);
                this.processTime = setTimeout(() => {
                    this.getProcess();
                }, 600)
            },


            // Ëé∑ÂèñÂΩìÂâçÂàóË°®
            getArticleList: function () {
                var menu = [];
                var idxs = 0;
                var re = /„Ää.*?„Äã|Ôºà.*?Ôºâ/img
                new Promise((r, s) => {
                    if (key === 'brws') {
                        var path = 'https://www.shishengru.com' + id;
                        this.getHtml(path).then(res => {
                            var xkj_text = localStorage.getItem('xkj_text');
                            if (xkj_text) this.xkj_text = JSON.parse(xkj_text);
                            var reimg = /<img.*?>/img
                            res = res.replace(reimg, '')
                            $box = $(res).find('.f-article-text > span')
                            $box.each(function (idx) {
                                title = $(this).find('a').text();
                                href = $(this).find('a').attr('href');
                                menu.push({
                                    'title': title,
                                    'id': href,
                                    'idx': idx
                                })
                            })
                            r(menu)
                        })

                    } else if (key === 'xkj') {
                        var path = this.apiUrl + '/api/article/menu';
                        var body = JSON.stringify({ "a_id": id });
                        var opt = { method: "post", body: body };
                        $echo.getJson(path, opt).then((res) => {
                            res = res['data'];
                            var xkj_text = localStorage.getItem('xkj_text');
                            if (xkj_text) this.xkj_text = JSON.parse(xkj_text);

                            res.forEach((item, idx) => {
                                item.title = item.title.replace(re, '');
                                item.idx = idx;
                                if (this.xkj_text['t' + id] == item.id) {
                                    idxs = idx;
                                }
                            })
                            menu = res;
                            r(res);
                        })
                    }
                }).then((menu) => {
                    menu.forEach((item, idx) => {
                        item.title = item.title.replace(re, '');
                        item.idx = idx;
                        if (this.xkj_text['t' + id] == item.id) {
                            idxs = idx;
                        }
                    })
                    this.menuList = menu;
                    this.len = menu.length;
                    this.toArticle(idxs)
                })
            }
        },
        created: function () {
            that = this;
        },
        mounted: function () {
            this.height = window.screen.availHeight
            // Â≠ó‰Ωì
            var font = localStorage.getItem('font')
            var fontSize = localStorage.getItem('fontSize');
            this.$nextTick(() => {
                if (font) {
                    this.currFontF = font;
                    this.setFontF();
                }
                // Â≠óÂè∑
                if (fontSize) {
                    this.setFontS(fontSize)
                }
                var xkj_text = localStorage.getItem('xkj_text');
                if (xkj_text) this.xkj_text = JSON.parse(xkj_text);
                var t = setInterval(() => {
                    if (this.articleD.html) {
                        clearInterval(t); // Ê∏ÖÈô§ËÆ°Êó∂Âô®
                        // Ë∑≥ËΩ¨Â∑≤ÈòÖËØª‰ΩçÁΩÆ
                        this.toPos(this.xkj_text['tn' + id])
                        // ÂêØÂä®Ëá™Âä®‰øùÂ≠ò
                        setInterval(() => {
                            this.savePos();
                        }, 6000);
                    }
                }, 50);

            })

            this.isDark = Boolean(eval($echo.getStorage('isDark'))); // ËΩ¨Êç¢Â∏ÉÂ∞îÂÄº
            if (this.isDark) { // ÊòØÂê¶ÂºÄÂêØË∑üÈöèÁ≥ªÁªü
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    this.theme = 4;
                } else {
                    this.theme = 1;
                }
            } else {
                this.theme = localStorage.getItem('theme') || 1;
            }
            this.getArticleList();
        }
    })
</script>

</html>