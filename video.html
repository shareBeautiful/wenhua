<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <meta name=App-Config content="fullscreen=yes,useHistoryState=yes,transition=yes">
    <meta content=yes name=apple-mobile-web-app-capable>
    <meta content=yes name=apple-touch-fullscreen>
    <meta content="telephone=no,email=no" name=format-detection>
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name=viewport
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <title></title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        #app {
            width: 100vw;
            height: 100vh;
            background: #000;
        }

        #my-video {
            width: 100%;
            max-width: 1000px;
            display: block;
            margin: 0 auto;
            height: auto;
            border: 1px solid #222;
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <video id="my-video" :src="videoSrc" controls preload="auto">
            <source :src="videoSrc" type="video/mp4" />
        </video>
    </div>
</body>
<script src="js/vue.js"></script>
<script>
    var that;
    new Vue({
        el: '#app',
        data: function () {
            return {
                title: '虚空济',
                apiUrl: 'https://api2022.xukongji.com',
                videoSrc: '',
            }
        },
        methods: {
            // 获取url参数
            getParams: function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return decodeURI(r[2]);
                return null;
            },
            getJson: function (url, config) {
                opt = {
                    headers: {
                        'Cache-Control': 'public,max-age=7200', //不缓存
                        'Content-Type': 'application/json'
                    }
                }
                if (config) Object.assign(opt, config)
                return fetch(url, opt).then((res) => {
                    if (res.ok) {
                        // text() 获取字符串，json()获取json数据
                        return res.json()
                    } else {
                        if (res.status === 404) {
                            alert('当前网页维护中...，请点击确定关闭')
                            window.close();
                        }
                        // 服务器异常
                        throw Error('')
                    }
                }).catch((error) => {
                    console.log('errorMessage', error)
                })
            }
        },
        created: function () {
            that = this;

        },
        mounted: function () {
            var id = parseInt(this.getParams('id'));
            var vid = parseInt(this.getParams('vid'));
            var path = this.apiUrl + '/api/article/menu';
            var body = JSON.stringify({ "a_id": id });
            var opt = { method: "post", body: body };
            this.getJson(path, opt).then((res) => {
                res = res['data'];
                res.forEach(item => {
                    if (item.id === vid) {
                        this.videoSrc = item.video_url;
                        this.w = item.width;
                        this.h = item.height;
                        document.title = item.title;
                    }
                });
            })
        }
    })
</script>

</html>